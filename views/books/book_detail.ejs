<%- include("../partials/header") %>
    <% var user %>
        <% if(user){ %>
            <%- include("../partials/books/take_control") %>
                <% } %>

                    <h3>Title: <%= title %>
                    </h3>
                    <h3> By: <a href="/user/<%= book.whoCreated._id %>" class="text-info">
                            <img src="kskfaksf" alt="" width="80" height="80" alt="profile">
                            <%= book.whoCreated.username %>
                        </a> <span> </span>
                        Date Created:
                    </h3>
                    <p>
                        <strong>Author</strong>
                        <a href="<%= book.author.url %>" class="text-info">
                            <%= book.author.name %>
                        </a>
                    </p>
                    <div >
                        <div class="row">
                            <div class="col-sm-12 col-md-6 col-lg-6 mb-5">
                                <img src="<%= book.picture %>" class="image-fluid" style="max-width:100%;height:auto"
                                    alt="book picture">
                                <div class="my-jumbo-box">
                                    <form action="/catalog/book/<%= book._id %>/like" method="POST" style="display: inline;">
                                        <button type="submit" class="btn btn-info" data-toggle="tooltip" title="Like this book"
                                        data-placement="top">
                                            <i class="fa fa-thumbs-up"></i><span class="badge badge-info"><%= book.like.length %></span>
                                        </button>
                                    </form>
                                    
                                    <a class="btn btn-success" data-toggle="tooltip" title="Comment on this book"
                                        data-placement="top" href="#comment">
                                        <i class="fa fa-comment"></i><span class="badge badge-success"><%= book.comments.length %></span>
                                    </a>
                                    <button class="btn btn-secondary" data-target="#shareModal" data-toggle="modal"
                                        data-toggle="tooltip" title="Share socially" data-placement="top">
                                        <i class="fa fa-share"></i>
                                    </button>

                                    <!-- START OF SHARE MODAL -->
                                    <div class="modal" id="shareModal">
                                        <div class="modal-dialog">
                                            <div class="modal-content">

                                                <!-- Modal Header -->
                                                <div class="modal-header">
                                                    <h4 class="modal-title">Share for others to see</h4>
                                                    <button type="button" class="close"
                                                        data-dismiss="modal">&times;</button>
                                                </div>

                                                <!-- Modal body -->
                                                <div>
                                                    <a class="twitter-share-button"
                                                        href="https://twitter.com/intent/tweet">Tweet</a>
                                                </div>

                                                <!-- Modal footer -->
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-info"
                                                        data-dismiss="modal">Close</button>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <!-- END OF SHARE MODAL -->

                                </div>
                            </div>
                            <div class="col-sm-12 col-md-6 col-lg-6">
                                <p>
                                    <strong>Summary:</strong>
                                    <%= book.summary %>
                                </p>
                                <p>
                                    <strong>Reason:</strong>
                                    <%= book.reason %>
                                </p>
                            </div>
                        </div>

                        <p>
                            <strong>Genre:</strong>&nbsp;
                            <% book.genre.forEach((genre, index, array)=>{ %>
                                <% if(index==array.length - 1){ %>
                                    <a href="<%= genre.url %>">
                                        <%= genre.name %>
                                    </a>
                                    <% }else{ %>
                                        <a href="<%= genre.url %>">
                                            <%= genre.name %>,
                                        </a>
                                        <% } %>
                                            <% }) %>
                        </p>
                            <div class="row">
                                <div class="col-sm-12 col-md-8">
                                    <h3 class="text-info my-jumbo-box">Comments</h3>

                                    <% if(book.comments.length> 0){ %>
                                        <% book.comments.forEach( (eachBookComment, index)=>{ %>
                                            <div class="media border p-3">
                                                <% if(eachBookComment.whoCommented.profilePicture){ %>
                                                    <img src="/images/theo.jpg" alt="John Doe" class="mr-3 mt-3 rounded-circle" style="width:60px;">
                                                <% }else{ %>
                                                    <figure class="story__shape">
                                                        <img src="/images/theo.jpg" alt="John Doe" class="mr-3 mt-3 rounded-circle" style="width:60px;">
                                                        <figcaption class="story__caption"><% eachBookComment.whoCommented.firstname %></figcaption>
                                                    </figure>
                                                <% } %>
                                                <div class="media-body">
                                                    <h4>
                                                        <a href="/user/<%= eachBookComment.whoCommented._id %>" style="text-decoration: underline;">
                                                        <%= eachBookComment.whoCommented.username%>
                                                        </a>
                                                        </h5><small><i><%= eachBookComment.date %></i></small>
                                                    </h4>
                                                    <p><%= eachBookComment.comment%></p>
                                                    <form action="/catalog/book/<%= book._id %>/comment/<%= eachBookComment._id %>/like" method="POST" style="display: inline;">
                                                        <button type="submit" class="btn btn-info" data-toggle="tooltip" title="Like this book"
                                                        data-placement="top">
                                                            <i class="fa fa-thumbs-up"></i><span class="badge badge-info"><%= eachBookComment.like.length %></span>
                                                        </button>
                                                    </form>
                                                    <% if(eachBookComment.replies.length > 0){ %>
                                                        <p>Nothing</p>
                                                        <% eachBookComment.replies.forEach( (comment, ind) =>{ %>
                                                            <button class="btn btn-success" title="Reply this comment" data-placement="top"  data-toggle="collapse" data-target="#demo"+index>
                                                                <i class="fa fa-reply"></i><span
                                                                    class="badge badge-success"><%= eachBookComment.replies.length %></span>
                                                            </button>
                                                            <div id="demo"+index class="collapse">
                                                                <div id="accordion">
                                                                    <div class="card">
                                                                      <div class="card-header">
                                                                        <a class="card-link" data-toggle="collapse" href="#collapseOne">
                                                                          Collapsible Group Item #1
                                                                        </a>
                                                                      </div>
                                                                      <div id="collapseOne" class="collapse show" data-parent="#accordion">
                                                                        <div class="card-body">
                                                                          Lorem ipsum..
                                                                        </div>
                                                                      </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        <% }) %>
                                                    <% }else{ %>
                                                        <button class="btn btn-success" title="Reply this comment" data-placement="top"  data-toggle="collapse" data-target="#demo<%= index %>">
                                                            <i class="fa fa-reply"></i><span
                                                                class="badge badge-success"><%= eachBookComment.replies.length %></span>
                                                        </button>
                                                        <div id="demo<%= index %>" class="collapse">
                                                            <p class="text-danger">!Ooops No replies at the moment <% index %></p>
                                                        </div>
                                                    <% } %>
                                                </div>
                                            </div>
                                            <% }) %>
                                                <% } else { %>
                                                    <p class="text-danger">No comments at the moment. You can be the
                                                        first to comment!</p>
                                                    <% } %>


                                                        <p></p>
                                                        <% if(user==undefined){ %>
                                                            <form action="/catalog/book/<%= book._id %>/comment"
                                                                method="POST">
                                                                <div class="clearfix">
                                                                    <div class="form-group">
                                                                        <textarea style="width: 80%"
                                                                            class="form-control float-right"
                                                                            name="comment" id=""
                                                                            placeholder="Enter your comment"></textarea>
                                                                    </div>
                                                                </div>
                                                                <br>
                                                                <div class="text-right">
                                                                    <input type="submit" value="Comment"
                                                                        class="btn btn-info">
                                                                </div>
                                                            </form>
                                                            <% } else {%>
                                                                <form action="/catalog/book/<%= book._id %>/comment"
                                                                    method="POST">
                                                                    <div class="clearfix" id="comment">
                                                                        <div class="form-group">
                                                                            <textarea
                                                                                class="form-control float-right"
                                                                                name="comment" 
                                                                                placeholder="Enter your comment">
                                                                            </textarea>
                                                                        </div>
                                                                        <input type="hidden" name="whoCommented"
                                                                            value="<%= user._id %>">
                                                                    </div>
                                                                    <br>
                                                                    <div class="text-right">
                                                                        <input type="submit" value="Comment"
                                                                            class="btn btn-info">
                                                                    </div>
                                                                </form>
                                                                <% } %>

                                </div>
                                <div class="col-sm-12 col-md-2"></div>
                            </div>
                        </div>

                    </div>
                    </div>

                    <%- include("../partials/footer") %>